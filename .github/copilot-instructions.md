# CrowdStrike gofalcon SDK

CrowdStrike gofalcon is a Go SDK for accessing CrowdStrike's Falcon APIs. The SDK is generated from OpenAPI specifications and provides type-safe access to all Falcon platform capabilities.

Always reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.

## Working Effectively

### Prerequisites and Setup
- Install Go 1.23.0 or newer: 
  ```bash
  # Check current version
  go version
  ```
- Install required tools for SDK regeneration:
  ```bash
  # Install jq (required version >= 1.7.1)
  apt-get update && apt-get install -y jq
  
  # Install go-swagger (specific fork required)
  go install github.com/ffalor/go-swagger/cmd/swagger@latest
  
  # Install golangci-lint for linting
  curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin
  
  # Ensure tools are in PATH
  export PATH=$PATH:/home/runner/go/bin
  ```

### Build and Test
- Download dependencies:
  ```bash
  go mod download
  ```
  Takes approximately 15-20 seconds (first time). NEVER CANCEL - set timeout to 2+ minutes.

- Build the SDK:
  ```bash
  make build
  ```
  Takes approximately 15-20 seconds (with warm cache) or 1+ minutes (cold build). NEVER CANCEL - set timeout to 5+ minutes.

- Run unit tests:
  ```bash
  go test ./...
  ```
  Takes approximately 15-20 seconds. NEVER CANCEL - set timeout to 2+ minutes.

- Format code:
  ```bash
  go fmt ./...
  ```

- Tidy dependencies:
  ```bash
  go mod tidy
  ```

- Run linter:
  ```bash
  golangci-lint run --timeout=3m12s
  ```
  Takes approximately 1-3 seconds (with warm cache) to 1+ minutes (cold). NEVER CANCEL - set timeout to 5+ minutes.

### SDK Regeneration Process
The SDK is generated from CrowdStrike's OpenAPI specifications. To regenerate:

1. **Obtain swagger.json manually:**
   ```bash
   # Download from appropriate region:
   # US-1: https://assets.falcon.crowdstrike.com/support/api/swagger.json
   # US-2: https://assets.falcon.us-2.crowdstrike.com/support/api/swagger-mav.json  
   # EU-1: https://assets.falcon.eu-1.crowdstrike.com/support/api/swagger-lion.json
   # Save as specs/swagger.json
   ```

2. **Regenerate SDK (only if swagger.json is present):**
   ```bash
   make clean-generate
   ```
   Takes approximately 2-3 minutes. NEVER CANCEL - set timeout to 10+ minutes.

## Validation

### Code Quality Validation
Always run these commands before committing:
```bash
go fmt ./...
go mod tidy
golangci-lint run --timeout=3m12s
```

### Functional Validation
ALWAYS test functionality using example programs. The examples require valid CrowdStrike API credentials.

- Test basic authentication and SDK initialization:
  ```bash
  cd examples/simple
  # Requires FALCON_CLIENT_ID and FALCON_CLIENT_SECRET environment variables
  go run main.go
  ```

- Test API client ID retrieval:
  ```bash
  cd examples/falcon_get_cid
  go run main.go --client-id="your_id" --client-secret="your_secret"
  ```

- Build example programs to verify SDK compilation:
  ```bash
  go build ./examples/simple
  go build ./examples/falcon_get_cid
  go build ./examples/falcon_sensor_download
  ```

### Manual Testing Requirements
After making changes to core SDK files:
1. Build at least 2-3 example programs to verify SDK compilation
2. If you have valid credentials, run one simple example to verify API connectivity
3. Always run the full linting and formatting pipeline
4. Check that generated files in `falcon/client/` and `falcon/models/` are not manually edited

## Project Structure

### Key Directories
- `falcon/` - Generated SDK client code (DO NOT EDIT MANUALLY)
  - `falcon/client/` - API client implementations (generated)
  - `falcon/models/` - API response/request models (generated)
- `examples/` - Standalone example programs and tools
- `pkg/falcon_util/` - Utility functions for SDK users
- `specs/` - OpenAPI specification files and transformation scripts
- `.github/workflows/` - CI/CD pipelines

### Generated vs Manual Code
- **NEVER edit files in `falcon/client/` or `falcon/models/`** - these are generated
- **Manual code areas:** `examples/`, `pkg/`, root-level configuration files
- All generated files contain header: "Code generated by go-swagger; DO NOT EDIT."

### Important Files
- `go.mod` - Go module definition and dependencies
- `Makefile` - Build automation (build, generate, clean-generate)
- `.golangci.yaml` - Linting configuration
- `specs/transformation.jq` - OpenAPI spec transformations for Go generation
- `.github/workflows/build.yml` - CI pipeline definition

## Common Tasks

### Adding New Examples
1. Create new directory under `examples/`
2. Include `main.go` and `README.md`
3. Follow existing patterns for credential handling using `falcon_util.PromptUser`
4. Test build: `go build ./examples/your_example`

### Debugging SDK Issues
1. Check if issue is in generated code (`falcon/client/`, `falcon/models/`)
2. If yes, issue likely needs OpenAPI spec fix in `specs/transformation.jq`
3. If no, check manual code in `pkg/` or example implementations
4. Always test with multiple examples to isolate issues

### CI Pipeline Requirements
The GitHub Actions CI requires:
- Go formatting: `go fmt ./...` must show no changes
- Module tidiness: `go mod tidy` must show no changes  
- Linting: `golangci-lint run --timeout=3m12s` must pass
- Build: `make build` must succeed
- Tests: `go test ./...` must pass

### Performance Expectations
- Dependency download: ~15-20 seconds (first time)
- Full build: ~15-20 seconds (warm cache) or 1+ minutes (cold build)
- Test execution: ~15-20 seconds
- Linting: ~1-3 seconds (warm) to 1+ minutes (cold)
- Individual example builds: ~1-2 seconds each
- SDK regeneration: ~2-3 minutes (if swagger.json available)

NEVER CANCEL long-running commands. Always set timeouts with adequate buffer:
- Build commands: 5+ minute timeout
- Test commands: 2+ minute timeout
- Lint commands: 5+ minute timeout
- Generation commands: 10+ minute timeout

## Troubleshooting

### Common Issues
- **Build failures in generated code:** Usually requires swagger.json update and regeneration
- **Import errors:** Run `go mod tidy` to fix dependency issues
- **Linting failures:** Most exclusions are for generated code, check manual code areas
- **Missing tools:** Ensure jq >= 1.7.1 and go-swagger are installed and in PATH

### API Credentials
Examples require CrowdStrike Falcon API credentials:
- Set `FALCON_CLIENT_ID` and `FALCON_CLIENT_SECRET` environment variables
- Or provide via command-line flags (varies by example)
- Credentials can be obtained from CrowdStrike Falcon console at https://falcon.crowdstrike.com/support/api-clients-and-keys

### Code Generation Dependencies
- **jq >= 1.7.1:** For OpenAPI spec transformations
- **go-swagger (ffalor fork):** For Go client generation
- **swagger.json:** Must be manually obtained from CrowdStrike Falcon console

## Complete Development Workflow Validation

### Full Development Cycle Test
Run this complete workflow to validate your development environment:

```bash
# 1. Clean workspace
go clean -modcache
go clean

# 2. Download dependencies and build  
go mod download
make build

# 3. Run tests and quality checks
go test ./...
go fmt ./...
go mod tidy
golangci-lint run --timeout=3m12s

# 4. Build example programs to verify SDK functionality
go build ./examples/simple
go build ./examples/falcon_get_cid  
go build ./examples/falcon_sensor_download

# 5. Verify no manual edits in generated code
find falcon/client falcon/models -name "*.go" -exec grep -l "Code generated by go-swagger; DO NOT EDIT." {} \;
```

Expected total time: 2-3 minutes for complete workflow.

### Manual Functionality Testing
If you have CrowdStrike API credentials, test basic functionality:

```bash
# Set credentials
export FALCON_CLIENT_ID="your_client_id"
export FALCON_CLIENT_SECRET="your_client_secret"

# Test basic API connectivity
cd examples/simple
go run main.go

# Expected output: "As of [timestamp] your CrowdScore is [number]."
```

**Note:** Build artifacts from `go build` commands are automatically ignored by `.gitignore`. Always use `go run` for testing or clean up binaries before committing.

### CI Pipeline Simulation
Simulate the GitHub Actions CI pipeline locally:

```bash
# Check formatting (must show no changes)
if [ "$(gofmt -s -l . | wc -l)" -gt 0 ]; then
    echo "FAIL: Code formatting issues found"
    gofmt -s -l -d .
    exit 1
fi

# Check module tidiness (must show no changes)  
if [ "$(go mod tidy -v | wc -l)" -gt 0 ]; then
    echo "FAIL: go mod tidy shows changes needed"
    exit 1
fi

echo "SUCCESS: All CI checks pass"
```